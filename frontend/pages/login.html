<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Login para empresas cadastradas na Prefeitura de General Sampaio. Acesse para gerenciar seu negócio.">
  <title>Login de Empresas - Prefeitura de General Sampaio</title>
  <link rel="icon" href="../../public/img/LogoGeneral.png" type="image/x-icon">
  <link rel="stylesheet" href="../css/login.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <main class="container" role="main" aria-label="Página de login de empresas">
    <div class="icon-center">
      <i class="fas fa-store" aria-hidden="true"></i>
    </div>
    <h1>Login de Empresas</h1>
    <p>Conectando empresas à tecnologia e oportunidades em General Sampaio!</p>

    <form id="loginForm" method="POST" action="/api/login" novalidate> <!-- Form semântico com action para API -->
      <div class="form-group">
        <label for="email">Email <span aria-hidden="true">*</span></label>
        <input 
          type="email" 
          id="email" 
          name="email" 
          placeholder="seu@email.com" 
          required 
          pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
          aria-describedby="email-error"
          aria-label="Digite seu email cadastrado"
        >
        <small id="email-error" class="error-msg" role="alert"></small> <!-- Para erros via JS -->
      </div>

      <div class="form-group">
        <label for="senha">Senha <span aria-hidden="true">*</span></label>
        <input 
          type="password" 
          id="senha" 
          name="senha" 
          placeholder="********" 
          required 
          minlength="8"
          aria-describedby="senha-error"
          aria-label="Digite sua senha (mínimo 8 caracteres)"
        >
        <small id="senha-error" class="error-msg" role="alert"></small>
      </div>

      <button type="submit" class="btn" id="btn-entrar">
        <i class="fas fa-sign-in-alt" aria-hidden="true"></i> Entrar
      </button>
    </form>

    <div class="links-secundarios">
      <a href="./recoverPassword.html" class="link-esqueci" aria-label="Recuperar senha">Esqueci a senha?</a>
    </div>

    <button class="btn-back" onclick="window.location.href='../index.html'" aria-label="Voltar à página inicial">
      <i class="fas fa-arrow-left" aria-hidden="true"></i> Voltar à Página Inicial
    </button>
  </main>

  <script>
    // JS básico para validação client-side e submit (sem libs, fácil de integrar com server.js)
    const form = document.getElementById('loginForm');
    const btnEntrar = document.getElementById('btn-entrar');
    const emailInput = document.getElementById('email');
    const senhaInput = document.getElementById('senha');

    // Função para mostrar/ocultar erros
    function showError(input, msg, show = true) {
      const errorEl = document.getElementById(input.id + '-error');
      errorEl.textContent = show ? msg : '';
      input.classList.toggle('error', show); // Adicione classe .error no CSS para estilo vermelho
      input.setAttribute('aria-invalid', show);
    }

    // Validação em tempo real (blur)
    emailInput.addEventListener('blur', () => {
      if (emailInput.value && !emailInput.validity.valid) {
        showError(emailInput, 'Email inválido. Use formato exemplo@dominio.com');
      } else {
        showError(emailInput, '', false);
      }
    });

    senhaInput.addEventListener('blur', () => {
      if (senhaInput.value.length < 8) {
        showError(senhaInput, 'Senha deve ter pelo menos 8 caracteres');
      } else {
        showError(senhaInput, '', false);
      }
    });

    // Submit do form
    form.addEventListener('submit', async (e) => {
      e.preventDefault(); // Previne submit nativo

      // Validação final
      let isValid = true;
      if (!emailInput.value || !emailInput.validity.valid) {
        showError(emailInput, 'Email é obrigatório e deve ser válido');
        isValid = false;
      }
      if (!senhaInput.value || senhaInput.value.length < 8) {
        showError(senhaInput, 'Senha é obrigatória (mínimo 8 caracteres)');
        isValid = false;
      }

      if (!isValid) return;

      // Loading no botão
      const originalText = btnEntrar.innerHTML;
      btnEntrar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Entrando...';
      btnEntrar.disabled = true;

      try {
        // Fetch POST para API (ajuste endpoint no server.js: ex: POST /api/login com body {email, senha})
        const res = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: emailInput.value, senha: senhaInput.value })
        });

        const data = await res.json();

        if (res.ok) {
          // Sucesso: Redireciona para dashboard (ajuste URL)
          alert('Login realizado com sucesso!'); // Ou window.location.href = '/dashboard.html';
        } else {
          throw new Error(data.error || 'Credenciais inválidas');
        }
      } catch (err) {
        console.error('Erro no login:', err);
        showError(emailInput, 'Erro no login. Verifique suas credenciais ou conexão.', false); // Limpa erros específicos
        alert('Erro: ' + err.message + '. Tente novamente.');
      } finally {
        // Reset botão
        btnEntrar.innerHTML = originalText;
        btnEntrar.disabled = false;
      }
    });
  </script>
</body>
</html>